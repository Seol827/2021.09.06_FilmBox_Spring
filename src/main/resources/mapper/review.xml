<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.film.mapper.ReviewMapper">

	<insert id="insertReview" parameterType="com.film.dto.ReviewDTO">
		insert into filmbox_review
		(member_id, movieCd, review_content, review_starpoint, review_date, rev_no )
		values
			( #{member_id} , #{movieCd} , #{review_content} , #{review_starpoint} , now(), #{rev_no} )
	</insert>
	
	
	<!-- (해당 영화의) 내 리뷰 -->
	<select id="getThisReview"  parameterType="com.film.dto.ReviewDTO" resultType="com.film.dto.ReviewDTO">
		select review_no, member_id, movieCd, review_content, review_starpoint, review_date, rev_no
		from filmbox_review
		where movieCd = ${movieCd} and member_id = #{member_id}
	</select>

	<update id="modifyReview" parameterType="com.film.dto.ReviewDTO">
		update filmbox_review
		 set
			review_content = #{review_content}
			, review_starpoint = #{review_starpoint}
			, review_date = now()		
		where movieCd = ${movieCd} and member_id = #{member_id}
	</update>
	
	<delete id="deleteReview" parameterType="com.film.dto.ReviewDTO">
		delete from filmbox_review
		where movieCd = ${movieCd} and member_id = #{member_id}
	</delete>
	
	<select id="getReviewList" parameterType="com.film.dto.ReviewDTO" resultType="java.util.HashMap">
		select review_no, r.member_id, movieCd, review_content, review_starpoint, review_date, member_name
		from filmbox_review as r inner join filmbox_member as m
		  on r.member_id = m.member_id
		 where movieCd = ${movieCd} 
		 order by review_no DESC
	</select>
</mapper>
    
    