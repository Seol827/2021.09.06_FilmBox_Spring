<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.film.mapper.PostMapper">

	
	<select id="getPostList" resultType="com.film.dto.PostDTO">
		SELECT  member_id, post_content, movieNm,image, post_date
		FROM filmbox_post
	</select>
	<select id="getMyMovie" parameterType="string" resultType="com.film.dto.MovieDTO">
		SELECT DISTINCT(movieNm), image FROM filmbox_member fm
		INNER JOIN filmbox_rev fr ON fm.member_id = fr.member_id
		INNER JOIN filmbox_movie fv ON fr.movieCd= fv.movieCd
		WHERE fm.member_id =#{member_id};
	</select>
	
	<insert id="insertPost" parameterType="com.film.dto.PostDTO">

        insert into filmbox_post ( member_id
        						, post_content
        						, movieNm
        						, image)
        	values(#{member_id}, #{post_content}, #{movieNm}, #{image})
           
	</insert>
	
	<select id="getMoviePostList" resultType="com.film.dto.PostDTO">
		SELECT fm.movieNm, COUNT(fm.movieNm) AS post_count,fm.image AS image
		FROM filmbox_post fp 
		INNER JOIN filmbox_movie fm ON fp.movieNm = fm.movieNm
		GROUP BY 1 ORDER BY 2 DESC
	</select>
</mapper>
    
    