<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.film.mapper.ReserveMapper">

		
	<insert id="reserveinsert" parameterType="com.film.dto.KakaopayDTO">
    	<selectKey keyProperty="rev_no" resultType="int" order="AFTER">
       		SELECT LAST_INSERT_ID() 
    	</selectKey>
    	insert into filmbox_rev ( movieCd, rev_date, price, rev_condition) 
    	values ( #{movieCd},now(), #{payMoney} ,0)
    </insert>
    <insert id="screeninsert" parameterType="com.film.dto.ScreenDTO">
    	
    	insert into filmbox_screen (rev_no,show_date, show_time, seatno) 
    	
    	values (#{rev_no},#{reserveDate}, #{screenTime},#{seats})
    </insert>
    
    <!-- <insert id="screeninsert" parameterType="java.util.List">
		insert into filmbox_screen (rev_no,show_date, show_time, seatno) 
		values
		<foreach item="item" index="index" collection="list"
			separator=" , ">
			(#{rev_no},#{reserveDate}, #{screenTime},#{seats})
		</foreach>
	</insert> -->
	
		<!-- 해당멤버가 해당 movieCd의 예약번호가 존재하는지 (=영화리뷰 쓸 수 있는지) = 예약테이블에서 -->
	<select id="isRevNo" parameterType="com.film.dto.reviewDTO" resultType="int">	 <!-- 파라미터 타입 id 생기면 kakaoDTO로 바꾸기 -->	
		select rev_no
		from filmbox_rev
		where member_id = #{member_id} and movieCd = ${movieCd}
		order by rev_no
		Limit 1
	</select>
    
</mapper>
    
    